<!-- src/components/UserSelector.astro -->
<style>
  .user-selector-container {
    position: absolute;
    top: 1rem;
    right: 1rem;
    z-index: 10;
    background: white;
    padding: 0.5rem;
    border-radius: 4px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  .user-selector-container label {
    display: block;
    margin-bottom: 0.25rem;
    font-size: 0.9rem;
    font-weight: bold;
  }
  .user-selector-container select {
    padding: 0.25rem;
    border-radius: 3px;
    border: 1px solid #ccc;
  }
  .user-selector-container small {
    display: block;
    font-size: 0.8rem;
    color: #666;
    margin-top: 0.25rem;
  }
</style>

<div class="user-selector-container">
  <label for="userId">Select User (Role):</label>
  <select id="userId" name="userId">
    <option value="newuser" selected>New User (basic)</option>
    <option value="editor">Editor (editor)</option>
    <option value="canaskonly">Ask only (qna)</option>
    <option value="admin">Admin (admin)</option>
  </select>
  <small>for permission testing.</small>
</div>

<script>
  // Plain JavaScript to handle user selection and dispatch event on the element
  const userIdSelect = document.getElementById('userId');

  if (userIdSelect instanceof HTMLSelectElement) { // Check type here for safety
    userIdSelect.addEventListener('change', () => {
      const selectedUserId = userIdSelect.value;
      console.log(`UserSelector: User ID changed to ${selectedUserId}. Dispatching element event.`);
      // Dispatch a custom event that bubbles up from this element
      userIdSelect.dispatchEvent(new CustomEvent('useridchange', {
        detail: { userId: selectedUserId },
        bubbles: true, // Allow event to bubble up
        composed: true // Allow event to cross shadow DOM boundaries
      }));
    });
  } else if (userIdSelect) {
     console.warn("UserSelector: Found element with ID 'userId', but it is not an HTMLSelectElement.");
  } else {
    console.warn("UserSelector: Could not find element with ID 'userId'.");
  }
</script>